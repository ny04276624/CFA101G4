<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.5.0.js"
        integrity="sha256-r/AaFHrszJtwpe+tHyNi/XCfMxYpbsRg2Uqn0x3s2zc=" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <title>Document</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/7.11.0/sweetalert2.all.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.0.18/sweetalert2.min.css">
	<!-- Include a polyfill for ES6 Promises (optional) for IE11 and Android browser -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/core-js/2.4.1/core.js"></script>
</head>
<style>
    body {
        background-color: rgb(233, 233, 233);
    }
</style>
<body>
    <div class="container-fluid ">
        <div class="row align-items-center p-4">
            <div class="col-6 ">
                <div class="row-cols-1 p-5">
                    <div class="col">
                        <img src="/CFA101G4/Img/logo去背1.png" class="img-fluid">
                    </div>
                    <div class="col mt-5 shadow-sm border-0">
                        <img src="/CFA101G4/Img/Enlogo.png" class="img-fluid">
                    </div>

                </div>
            </div>
           
            <div class="col p-3">
            <form id="form">
                <div class="row justify-content-center bg-light p-3 shadow-lg" style="border-radius: 20px;">
                    <div class="form-floating mb-1 w-75">
                        <div class="row">
                            <div class="col">
                                <p class="fs-6 mb-1">姓名</p>
                                <input type="text" class="form-control pt-1 ps-1 w-75 h-50" placeholder="請輸入姓名" name="membername" id="membername">
                                <p class="fs-6 text-danger mb-0"></p>
                            </div>
                            <div class="col">
                                <p class="fs-6 mb-1">手機</p>
                                <input type="text" class="form-control pt-0 ps-1 w-100 h-50 pb-0" 
                                    placeholder="請輸入手機號碼" name="tel" id="tel">
                                <p class="fs-6 text-danger mb-0"></p>
                            </div>
                        </div>
                    </div>
                    <div class="mb-0 w-75">
                        <p class="fs-6 mb-1 mt-3">註冊帳號</p>
                        <input type="text" class="form-control ps-1" placeholder="請輸入帳號" aria-label="Username"
                            aria-describedby="addon-wrapping" name="account" id="account">
                        <p class="" id="checkAcc"></p>
                    </div>
                    <div class="mb-0 w-75 mb-1">
                        <p class="fs-6 mb-1 mt-2">註冊密碼</p>
                        <input type="password" class="form-control ps-1" placeholder="請輸入密碼" aria-label="Username"
                            aria-describedby="addon-wrapping" name="password" id="password">
                        <p class="fs-6 text-danger mb-0 "></p>
                    </div>
                    <div class="row w-75 p-0">
                        <div class="col">
                            <input type="text" class="form-control" placeholder="身分證字號" aria-label="Username"
                                aria-describedby="basic-addon1" name="UID" id="UID">
                            <p class="fs-6 text-danger mb-0 "></p>
                        </div>
                        <div class="col">
                            <input type="email" class="form-control" id="email"
                                placeholder="name@example.com" name="email" id="">
                            <p class="fs-6 text-danger mb-0 "></p>
                        </div>
                    </div>
                    <div class="col-12 w-75  mt-1">
                        <p class="fs-6 mb-0">地址</p>
                        <div class="row">
                            <div class="col">
                                <select class="form-select" aria-label="Default select example" id="縣市1">
                                    
                                </select>
                            </div>
                            <div class="col">
                                <select class="form-select" aria-label="Default select example" id="鄉鎮市區1">
                                   
                                </select>
                            </div>
                            <div class="col">
                                <input class="form-control" type="text" placeholder="地址" aria-label="default input example" id="address">
                            </div>
                        </div>
                        <p class="fs-6 text-danger mb-0 "></p>
                        <input class="form-control mt-1" type="date" placeholder="生日" aria-label="default input example" name="bth" id="bth">
                        <p class="fs-6 text-danger mb-0 "></p>
                    </div>
                    <div class="row w-75 p-0 mt-2" style="border-bottom: 1px solid rgb(167, 167, 167);">
                        <div class="col w-75">
                            <label class="me-4">性別</label>
                            <input class="form-check-input " type="radio" name="sex" id="flexRadioDefault1"
                               value="1">
                            <label class="form-check-label me-3" for="flexRadioDefault1">
                                男生
                            </label>
                            <input class="form-check-input" type="radio" name="sex" id="flexRadioDefault2" value="0" checked>
                            <label class="form-check-label" for="flexRadioDefault2">
                                女生
                            </label>
                        </div>
                    </div>
                    <div class="col-12 text-center mt-2 mb-1">
                        <button type="button" class="btn btn-outline-secondary me-2" id="submit">註冊</button>
                        
                    </div>
                </div>
                </form>
            </div>
          
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <script src="/CFA101G4/JS/Front-end-js/taiwan_address_auto_change.js"></script>
      <script>
    var timestamp = new Date().getTime();
    console.log(timestamp);
    	var checkflag = false;
		function checkAccountisExist(){
			let account = $("#account").val();
			
			$.ajax({
				url: "/CFA101G4/registerServlet",
				type:"POST",
				data:{
					account:account,
					action:"checkAccExist"
				},
				dataType:"json",
				success:function(data){
					if(data.userExist==true){
						$("#checkAcc").css("color", "green");
						$("#checkAcc").html(data.msg);
						checkflag=true;

					}else{
						$("#checkAcc").css("color", "red");
						$("#checkAcc").html(data.msg);
						checkflag=false;

					}
				}
			})
			
		}
        function checkAccount(){
            let account = $("#account").val();
            let reg_account = /^\w{5,15}$/;
            let flag = reg_account.test(account);
            if(flag){
                $("#account").css("border", "3px solid green");
            }else{
                $("#account").css("border", "3px solid red");
            }
            return flag;
        }
        function checkPassword(){
            let password = $("#password").val();
            let reg_password = /^\w{5,15}$/;            
            let flag = reg_password.test(password);
            if(flag){
                $("#password").css("border", "3px solid green");
            }else{
                $("#password").css("border", "3px solid red");
            }
            return flag;
        }


        function checkMembername(){
            let membername = $("#membername").val();
            let reg_membername = /^[\u4e00-\u9fa5\w]{2,15}$/;
            let flag = reg_membername.test(membername);
            if(flag){
                $("#membername").css("border", "3px solid green");
            }else{
                $("#membername").css("border", "3px solid red");
            }
            return flag;
        }
        function checkUID(){
            let UID = $("#UID").val();
            let reg_UID = /^[A-Z]{1}\d{9}$/;
            let flag = reg_UID.test(UID);
            if(flag){
                $("#UID").css("border", "3px solid green");
            }else{
                $("#UID").css("border", "3px solid red");
            }
            return flag;
        }
        function checkAddress(){
            let address = $("#address").val();
            let reg_address = /^[\u4e00-\u9fa5\w]{5,100}$/;	
            let flag = reg_address.test(address);
            if(flag){
                $("#address").css("border", "3px solid green");
            }else{
                $("#address").css("border", "3px solid red");
            }
            return flag;

        }
        function checkBth(){
            let bth = $("#bth").val();
            console.log(bth);
            let flag = true;
            if(bth!=""){
                $("#bth").css("border", "3px solid green");
                flag = true;
            }else{
                $("#bth").css("border", "3px solid red");
                flag = false;
            }
            return flag;

        }
        function checkEmail(){
            let email = $("#email").val();
            let reg_email = /^\w+@\w+\.\w+$/;
            let flag = reg_email.test(email);
            if(flag){
                $("#email").css("border", "3px solid green");
            }else{
                $("#email").css("border", "3px solid red");
            }
            return flag;
        }
        function checkTel(){
            let tel = $("#tel").val();
            let reg_tel = /^09\d{8}$/;
            let flag = reg_tel.test(tel);
            if(flag){
                $("#tel").css("border", "3px solid green");
            }else{
                $("#tel").css("border", "3px solid red");
            }
            return flag;
        }

        let bth = $("#bth").val();
        console.log(bth);
        
        
                //用入口函數調用所有input方法
        $(function(){
        	 AddressSeleclList.Initialize('縣市1', '鄉鎮市區1');
        	 
            $("#submit").on("click", function(){      
            	var timestamp = new Date().getTime();
                      if(checkflag && checkAccount() && checkPassword() && checkMembername() && checkUID() && checkAddress() && checkBth() && checkEmail() && checkTel() ){        
                    	 let lastpart = $("#address").val();
                    	 let fullpart = AddressSeleclList.ReturnSelectAddress('縣市1', '鄉鎮市區1')+lastpart;
                    	 let data =  $("#form").serialize();
                    	 data+='&' + $.param({address:fullpart});
                            $.ajax({
                                url: "/CFA101G4/registerServlet?"+timestamp,
                                type:"POST",
                                data:data+"&action=register",
                                success:function(data){
                                   console.log(data);
                                   window.location.assign("/CFA101G4/front-end/register_success.html")
//                                    
                                },
                                error:function(){
                                	swal(
                              			  '會員註冊失敗！',
                              			  '請檢查您的資料是否皆正確，且不可有任何一欄為空！',
                              			  'error'
                              			)
                                }                       	
                            })
                        }else{
                        		swal(
                        			  '會員註冊失敗！',
                        			  '請檢查您的資料是否皆正確，且不可有任何一欄為空！',
                        			  'error'
                        			)
                            return false;
                        }   
         })
    })
 

            $("#account").on("input", checkAccount);
       		$("#account").on("blur", checkAccountisExist);
            $("#password").on("input", checkPassword);
            $("#membername").on("input", checkMembername);
            $("#UID").on("input", checkUID);
            $("#address").on("input", checkAddress);
            $("#bth").on("input", checkBth);
            $("#email").on("input", checkEmail);
            $("#tel").on("input", checkTel);

    </script>
</body>


</html>